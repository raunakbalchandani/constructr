; Supervisor configuration for Foreperson.ai
; Copy to: /etc/supervisor/conf.d/foreperson.conf
; Then run: sudo supervisorctl reread && sudo supervisorctl update

[program:foreperson-backend]
command=/opt/foreperson/venv/bin/uvicorn backend.api:app --host 127.0.0.1 --port 8000
directory=/opt/foreperson
user=foreperson
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stderr_logfile=/opt/foreperson/logs/backend.err.log
stdout_logfile=/opt/foreperson/logs/backend.out.log
environment=
    DATABASE_PATH="/opt/foreperson/foreperson.db",
    UPLOAD_DIR="/opt/foreperson/uploads",
    SECRET_KEY="%(ENV_SECRET_KEY)s"

[program:foreperson-frontend]
command=/usr/bin/npm start
directory=/opt/foreperson/frontend
user=foreperson
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stderr_logfile=/opt/foreperson/logs/frontend.err.log
stdout_logfile=/opt/foreperson/logs/frontend.out.log
environment=
    NODE_ENV="production",
    PORT="3000"

[group:foreperson]
programs=foreperson-backend,foreperson-frontend
priority=999
